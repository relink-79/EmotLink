{% extends "base.html" %}

{% block title %}Link 생성 - EmotLink{% endblock %}

{% block content %}
<div class="bg-white p-8 rounded-xl shadow-md border border-gray-200">
  <h2 class="text-2xl font-bold text-gray-800 mb-6">Link 생성</h2>

  <h3 class="text-lg font-semibold text-gray-700 mb-3">받은 요청</h3>
  {% if pending and pending|length > 0 %}
    <ul class="divide-y divide-gray-200">
      {% for req in pending %}
        {% set linker = linker_map.get(req.linker_id) %}
        <li class="py-4 flex items-center justify-between">
          <div>
            {% if linker %}
              <div class="font-semibold text-gray-800">{{ linker.name }} <span class="text-gray-500 text-sm">(@{{ linker.id }})</span></div>
              <div class="text-sm text-gray-500">{{ linker.email }}</div>
            {% else %}
              <div class="font-semibold text-gray-800">{{ req.linker_id }}</div>
            {% endif %}
            <div class="text-xs text-gray-400 mt-1">요청 상태: {{ req.status|default('pending') }}</div>
          </div>
          <div class="flex items-center gap-2">
            <form action="/links/requests/{{ req.linker_id }}/accept" method="post">
              <button type="submit" class="px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700">수락</button>
            </form>
            <form action="/links/requests/{{ req.linker_id }}/decline" method="post">
              <button type="submit" class="px-4 py-2 bg-white border text-gray-700 rounded-lg hover:bg-gray-50">거절</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="text-gray-500 mb-6">받은 요청이 없습니다.</div>
  {% endif %}

  <h3 class="text-lg font-semibold text-gray-700 mt-8 mb-3">연결된 Link</h3>
  {% if accepted and accepted|length > 0 %}
    <ul class="divide-y divide-gray-200">
      {% for link in accepted %}
        {% set linker = linker_map.get(link.linker_id) %}
        <li class="py-4 flex items-center justify-between">
          <div>
            {% if linker %}
              <div class="font-semibold text-gray-800">{{ linker.name }} <span class="text-gray-500 text-sm">(@{{ linker.id }})</span></div>
              <div class="text-sm text-gray-500">{{ linker.email }}</div>
            {% else %}
              <div class="font-semibold text-gray-800">{{ link.linker_id }}</div>
            {% endif %}
            <div class="text-xs text-gray-400 mt-1">상태: 연결됨</div>
          </div>
          <div>
            <form action="/links/{{ link.linker_id }}/remove" method="post">
              <button type="submit" class="px-4 py-2 bg-white border text-gray-700 rounded-lg hover:bg-gray-50">연결 해제</button>
            </form>
          </div>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <div class="text-gray-500">연결된 Link가 없습니다.</div>
  {% endif %}
</div>
{% endblock %}
